---
### File managed with puppet ###
## Served by:        '<%= scope.lookupvar('::servername') %>'
## Module:           '<%= scope.to_hash['module_name'] %>'
## Template source:  'MODULES<%= template_source.gsub(Regexp.new("^#{Puppet::Node::Environment.current[:modulepath].gsub(':','|')}"),"") %>'

# SSL Setup
#
# if enabled, all communication would be verfied via SSL
# NOTE that both certificates need to be signed by the same CA in order for this to work
# see http://theforeman.org/projects/smart-proxy/wiki/SSL for more information
<% if @ssl and @ssl != :undef -%>
<% if @ssldir and @ssldir != :undef -%>
:ssldir: <%= @ssldir %>
<% end -%>
:ssl_certificate: <%= @ssl_certificate %>
:ssl_ca_file:  <%= @ssl_ca_file %>
:ssl_private_key: <%= @ssl_private_key %>
<% else -%>
#:ssl_certificate: ssl/certs/fqdn.pem
#:ssl_ca_file: ssl/certs/ca.pem
#:ssl_private_key: ssl/private_keys/fqdn.key
<% end -%>
# the hosts which the proxy accepts connections from
# commenting the following lines would mean every verified SSL connection allowed
<% if @ssl and @trusted_hosts != :undef
    trusted = @trusted_hosts
    trusted = [ trusted ] unless trusted.is_a?(Array)
-%>
:trusted_hosts:
<% trusted.each do |host| -%>
  - <%= host %>
<% end -%>
<% else -%>
#- foreman.prod.domain
#- foreman.dev.domain
<% end -%>

# enable the daemon to run in the background
:daemon: true
:daemon_pid: /var/run/foreman-proxy/foreman-proxy.pid

# port used by the proxy
:port: <%= @port %>

# Enable TFTP management
:tftp: <%= @tftp %>
:tftproot: <%= @tftp_root %>
:tftp_servername: <%= @tftp_servername %>
# Defines the TFTP Servername to use, overrides the name in the subnet declaration
#:tftp_servername: tftp.domain.com

# Enable DNS management
:dns: <%= @dns %>
:dns_key: <%= @dns_keyfile %>
# use this setting if you are managing a dns server which is not localhost though this proxy
:dns_server: <%= @dns_server %>

# Enable DHCP management
:dhcp: <%= @dhcp %>
<% if @dhcp == true -%>
:dhcp_vendor: <%= @dhcp_vendor %>
:dhcp_config: <%= @dhcp_config %>
:dhcp_leases: <%= @dhcp_leases %>
<% else -%>
# The vendor can be either isc or native_ms
:dhcp_vendor: isc
# dhcp_subnets is a Native MS implementation setting. It restricts the subnets queried to a
# subset, so as to reduce the query time.
#:dhcp_subnets: [192.168.205.0/255.255.255.128, 192.168.205.128/255.255.255.128]
# Settings for Ubuntu ISC
#:dhcp_config: /etc/dhcp3/dhcpd.conf
#:dhcp_leases: /var/lib/dhcp3/dhcpd.leases
# Settings for Redhat ISC
#:dhcp_config: /etc/dhcpd.conf
#:dhcp_leases: /var/lib/dhcpd/dhcpd.leases
#:dhcp_key_name: secret_key_name
#:dhcp_key_secret: secret_key
<% end -%>

# enable PuppetCA management
:puppetca: <%= @puppetca %>

# enable Puppet management
:puppet: <%= @puppetrun %>
:puppet_conf: /etc/puppet/puppet.conf

# Where our proxy log files are stored
# filename or STDOUT
:log_file: <%= @log %>
# valid options are
# WARN, DEBUG, Error, Fatal, INFO, UNKNOWN
#:log_level: DEBUG
